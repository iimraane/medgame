(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const H="medgame_save",G="medgame_settings",j={currentLevel:1,maxUnlockedLevel:1,scores:{},unlockedCards:[],firstTime:!0},R={volume:.5,soundEnabled:!0,animationsEnabled:!0,transcriptionEnabled:!1};function x(){try{const e=localStorage.getItem(H);return e?{...j,...JSON.parse(e)}:{...j}}catch{return{...j}}}function le(e){localStorage.setItem(H,JSON.stringify(e)),document.cookie=`medgame_active=true; max-age=${3600*24*365}; path=/`}function ue(){try{const e=localStorage.getItem(G);return e?{...R,...JSON.parse(e)}:{...R}}catch{return{...R}}}function we(e){localStorage.setItem(G,JSON.stringify(e))}function ce(){localStorage.removeItem(H),localStorage.removeItem(G),document.cookie="medgame_active=; max-age=0; path=/"}function $e(e,s,t){const i=x(),a=i.scores[e];return!a||s>a.score?i.scores[e]={score:s,stars:t,attempts:((a==null?void 0:a.attempts)||0)+1}:i.scores[e].attempts+=1,t>=1&&e>=i.maxUnlockedLevel&&(i.maxUnlockedLevel=e+1),le(i),i}function Ie(e){const s=x(),t=e.filter(i=>!s.unlockedCards.includes(i));return s.unlockedCards=[...s.unlockedCards,...t],s.firstTime=!1,le(s),t}function ne(e){const s=x(),t=s.maxUnlockedLevel>1;e.innerHTML=`
    <div class="view menu">
      <div class="menu__logo">üè•</div>
      <h1 class="menu__title">MedGame</h1>
      <p class="menu__subtitle">Simulation de Consultation M√©dicale</p>
      <div class="menu__actions">
        ${t?`
          <button class="btn btn--primary" id="btn-continue">
            ‚ñ∂Ô∏è Continuer (Niveau ${s.maxUnlockedLevel})
          </button>
        `:""}
        <button class="btn btn--primary" id="btn-play">
          ${t?"üìã S√©lection de niveau":"ü©∫ Commencer"}
        </button>
        <button class="btn btn--secondary" id="btn-settings">
          ‚öôÔ∏è Param√®tres
        </button>
        ${t?`
          <button class="btn btn--danger" id="btn-reset">
            üóëÔ∏è Tout r√©initialiser
          </button>
        `:""}
      </div>
    </div>
  `;const i=e.querySelector("#btn-continue");i&&i.addEventListener("click",()=>{c("game",{levelId:s.maxUnlockedLevel})}),e.querySelector("#btn-play").addEventListener("click",()=>{c("levels")}),e.querySelector("#btn-settings").addEventListener("click",()=>{c("settings")});const a=e.querySelector("#btn-reset");a&&a.addEventListener("click",()=>{confirm("‚ö†Ô∏è √ätes-vous s√ªr de vouloir tout r√©initialiser ? Toute votre progression sera perdue.")&&(ce(),c("menu"))})}const de=[{id:1,name:"Premier Jour",description:"Un patient simple avec un probl√®me courant. Prenez vos marques !",difficulty:"debutant",modifierCount:2,cardPool:["rhume","grippe"],possibleConditions:["rhume","grippe"],maxMessages:20,unlockPerk:null},{id:2,name:"Les Bases",description:"Le patient peut avoir des questions simples. Restez attentif.",difficulty:"debutant",modifierCount:2,cardPool:["rhume","grippe","allergie_saisonniere","migraine"],possibleConditions:["allergie_saisonniere","migraine"],maxMessages:20,unlockPerk:null},{id:3,name:"Premiers D√©fis",description:"Les patients commencent √† avoir une personnalit√© plus marqu√©e.",difficulty:"debutant",modifierCount:3,cardPool:["rhume","grippe","allergie_saisonniere","migraine","gastro_enterite"],possibleConditions:["gastro_enterite","rhume","migraine"],maxMessages:22,unlockPerk:"fichePatient"},{id:4,name:"Consultations Multiples",description:"Deux sympt√¥mes possibles. Le patient est un peu stress√©.",difficulty:"facile",modifierCount:3,cardPool:["rhume","grippe","allergie_saisonniere","migraine","gastro_enterite","hypertension","angine"],possibleConditions:["hypertension","angine"],maxMessages:22,unlockPerk:null},{id:5,name:"Questions Difficiles",description:"Le patient pose des questions pointues. Soyez pr√©cis.",difficulty:"facile",modifierCount:4,cardPool:["rhume","grippe","allergie_saisonniere","migraine","gastro_enterite","hypertension","angine","diabete_type2"],possibleConditions:["diabete_type2","angine"],maxMessages:24,unlockPerk:"reponsesRapides"},{id:6,name:"Patients Inquiets",description:"L'anxi√©t√© du patient rend la consultation plus complexe.",difficulty:"facile",modifierCount:4,cardPool:["hypertension","diabete_type2","asthme","angine","otite","migraine"],possibleConditions:["asthme","otite"],maxMessages:24,unlockPerk:null},{id:7,name:"Diagnostic Diff√©rentiel",description:"Les sympt√¥mes peuvent correspondre √† plusieurs pathologies.",difficulty:"facile",modifierCount:4,cardPool:["hypertension","diabete_type2","asthme","angine","otite","allergie_saisonniere","grippe","rhume"],possibleConditions:["asthme","grippe","allergie_saisonniere"],maxMessages:25,unlockPerk:"referenceMedicale"},{id:8,name:"Patients Complexes",description:"Personnalit√©s marqu√©es et sympt√¥mes multiples.",difficulty:"moyen",modifierCount:5,cardPool:["depression","anxiete","lombalgie","hypertension","diabete_type2","asthme","migraine"],possibleConditions:["depression","anxiete","lombalgie"],maxMessages:26,unlockPerk:null},{id:9,name:"En Profondeur",description:"Il faut creuser pour trouver la vraie cause.",difficulty:"moyen",modifierCount:5,cardPool:["depression","anxiete","lombalgie","arthrite","dermatite","asthme","migraine"],possibleConditions:["arthrite","dermatite"],maxMessages:26,unlockPerk:"analysesLaboratoire"},{id:10,name:"Patient Difficile",description:"La communication est compliqu√©e. Restez professionnel.",difficulty:"moyen",modifierCount:6,cardPool:["depression","anxiete","lombalgie","arthrite","dermatite","hypertension","diabete_type2"],possibleConditions:["depression","hypertension","diabete_type2"],maxMessages:28,unlockPerk:null},{id:11,name:"Urgence Mod√©r√©e",description:"Le temps presse un peu. Priorisez vos questions.",difficulty:"moyen",modifierCount:6,cardPool:["pneumonie","asthme","hypertension","anxiete","lombalgie","arthrite","otite"],possibleConditions:["pneumonie","arthrite"],maxMessages:28,unlockPerk:"pauseCafe"},{id:12,name:"Consultations √† Risque",description:"Les pathologies sont plus graves. Attention aux signaux d'alerte.",difficulty:"difficile",modifierCount:7,cardPool:["pneumonie","thyroide","insuffisance_cardiaque","anemie","hypertension","diabete_type2","depression"],possibleConditions:["thyroide","insuffisance_cardiaque"],maxMessages:30,unlockPerk:null},{id:13,name:"Cas Sensibles",description:"Sujets d√©licats. Tact et professionnalisme requis.",difficulty:"difficile",modifierCount:7,cardPool:["ist","depression","anxiete","anemie","thyroide","dermatite"],possibleConditions:["ist","anemie"],maxMessages:30,unlockPerk:"imagerieMedicale"},{id:14,name:"Sympt√¥mes Trompeurs",description:"Rien n'est ce qu'il semble √™tre. M√©fiez-vous des √©vidences.",difficulty:"difficile",modifierCount:7,cardPool:["pneumonie","thyroide","insuffisance_cardiaque","anemie","ist","depression","asthme","lombalgie"],possibleConditions:["insuffisance_cardiaque","thyroide","pneumonie"],maxMessages:30,unlockPerk:null},{id:15,name:"Le Grand Test",description:"Un patient avec une situation m√©dicale et psychologique complexe.",difficulty:"difficile",modifierCount:8,cardPool:["pneumonie","thyroide","insuffisance_cardiaque","anemie","ist","depression","anxiete","hypertension","diabete_type2"],possibleConditions:["anemie","depression","hypertension"],maxMessages:32,unlockPerk:"antecedents"},{id:16,name:"Urgences Vitales",description:"Des cas graves qui n√©cessitent une prise en charge rapide.",difficulty:"expert",modifierCount:8,cardPool:["embolie_pulmonaire","avc","pneumonie","insuffisance_cardiaque","hypertension","diabete_type2"],possibleConditions:["embolie_pulmonaire","avc"],maxMessages:30,unlockPerk:null},{id:17,name:"Cas Critiques",description:"Le patient peut √™tre en d√©ni. Chaque question compte.",difficulty:"expert",modifierCount:9,cardPool:["embolie_pulmonaire","avc","meningite","pancreatite","pneumonie","insuffisance_cardiaque"],possibleConditions:["meningite","pancreatite"],maxMessages:30,unlockPerk:"indiceDiagnostic"},{id:18,name:"Sous Pression",description:"Patients agressifs ou en panique. Gardez votre sang-froid.",difficulty:"expert",modifierCount:9,cardPool:["embolie_pulmonaire","avc","meningite","pancreatite","pneumonie","insuffisance_cardiaque","thyroide"],possibleConditions:["embolie_pulmonaire","meningite","pancreatite"],maxMessages:32,unlockPerk:null},{id:19,name:"Le Sp√©cialiste",description:"Maladies rares et complexes. Seuls les meilleurs y arrivent.",difficulty:"maitre",modifierCount:10,cardPool:["lupus","sclerose_en_plaques","maladie_de_crohn","embolie_pulmonaire","meningite","avc","pancreatite"],possibleConditions:["lupus","sclerose_en_plaques","maladie_de_crohn"],maxMessages:35,unlockPerk:"avisConfrere"},{id:20,name:"Ma√Ætre Docteur",description:"Le d√©fi ultime. Une consultation √† tr√®s haut risque.",difficulty:"maitre",modifierCount:10,cardPool:["lupus","sclerose_en_plaques","maladie_de_crohn","endocardite","embolie_pulmonaire","meningite","avc","pancreatite"],possibleConditions:["endocardite","lupus","sclerose_en_plaques"],maxMessages:35,unlockPerk:null}];function je(e){return de.find(s=>s.id===e)}const Re={rhume:{id:"rhume",name:"Rhume",emoji:"ü§ß",category:"ORL",description:"Infection virale b√©nigne des voies a√©riennes sup√©rieures.",symptoms:["√âcoulement nasal","√âternuements","Gorge irrit√©e","L√©g√®re fatigue","Toux l√©g√®re"],questionsToAsk:["Depuis quand avez-vous ces sympt√¥mes ?","Avez-vous de la fi√®vre ?","Avez-vous des douleurs musculaires ?","√ätes-vous en contact avec des personnes malades ?"],treatment:"Repos, hydratation, parac√©tamol si besoin. Pas d'antibiotiques.",redFlags:["Fi√®vre > 39¬∞C pendant plus de 3 jours","Difficult√©s respiratoires","Douleurs thoraciques"]},grippe:{id:"grippe",name:"Grippe",emoji:"ü§í",category:"Infectiologie",description:"Infection virale aigu√´ avec fi√®vre √©lev√©e et courbatures.",symptoms:["Fi√®vre √©lev√©e (>38.5¬∞C)","Courbatures intenses","Fatigue extr√™me","Maux de t√™te","Toux s√®che","Frissons"],questionsToAsk:["Depuis quand les sympt√¥mes sont-ils apparus ?","Avez-vous √©t√© vaccin√© contre la grippe ?","Avez-vous des probl√®mes respiratoires chroniques ?","√ätes-vous en contact avec des personnes fragiles ?"],treatment:"Repos, hydratation abondante, parac√©tamol pour la fi√®vre. Oseltamivir si pris dans les 48h.",redFlags:["Difficult√©s respiratoires","Confusion","Fi√®vre qui ne baisse pas apr√®s 5 jours"]},allergie_saisonniere:{id:"allergie_saisonniere",name:"Allergie Saisonni√®re",emoji:"üå∏",category:"Allergologie",description:"R√©action allergique au pollen causant rhinite et conjonctivite.",symptoms:["√âternuements r√©p√©t√©s","Yeux qui pleurent/d√©mangent","Nez bouch√©","Gorge qui gratte","Fatigue"],questionsToAsk:["√Ä quelle p√©riode ces sympt√¥mes apparaissent-ils ?","Avez-vous des ant√©c√©dents d'allergie ?","Les sympt√¥mes s'aggravent-ils en ext√©rieur ?","Avez-vous des animaux de compagnie ?"],treatment:"Antihistaminiques, cortico√Ødes nasaux, √©viter l'exposition aux allerg√®nes.",redFlags:["Difficult√©s respiratoires","Gonflement du visage ou de la gorge","Asthme associ√©"]},migraine:{id:"migraine",name:"Migraine",emoji:"ü§ï",category:"Neurologie",description:"C√©phal√©es r√©currentes, souvent unilat√©rales, avec photophobie.",symptoms:["Douleur pulsatile d'un c√¥t√©","Naus√©es","Sensibilit√© √† la lumi√®re","Sensibilit√© au bruit","Aura visuelle possible"],questionsToAsk:["O√π se situe exactement la douleur ?","Combien de temps dure une crise ?","Avez-vous des troubles visuels avant la douleur ?","Y a-t-il des facteurs d√©clenchants (stress, alimentation, sommeil) ?"],treatment:"Triptans en crise, parac√©tamol/ibuprof√®ne, repos dans le calme et l'obscurit√©. Traitement de fond si fr√©quent.",redFlags:["Premi√®re migraine apr√®s 50 ans","Pire mal de t√™te de sa vie","Fi√®vre associ√©e","D√©ficit neurologique"]},gastro_enterite:{id:"gastro_enterite",name:"Gastro-ent√©rite",emoji:"ü§¢",category:"Gastro-ent√©rologie",description:"Infection digestive virale ou bact√©rienne avec diarrh√©e et vomissements.",symptoms:["Diarrh√©e","Vomissements","Douleurs abdominales","Fi√®vre mod√©r√©e","Naus√©es"],questionsToAsk:["Depuis quand durent les sympt√¥mes ?","Combien de fois par jour allez-vous aux toilettes ?","Arrivez-vous √† vous hydrater ?","Y a-t-il du sang dans les selles ?","Avez-vous mang√© quelque chose d'inhabituel r√©cemment ?"],treatment:"R√©hydratation orale, r√©gime l√©ger, anti√©m√©tiques si n√©cessaire. Pas d'antibiotiques sauf salmonellose.",redFlags:["D√©shydratation s√©v√®re","Sang dans les selles","Fi√®vre > 39¬∞C","Sympt√¥mes > 5 jours"]},hypertension:{id:"hypertension",name:"Hypertension Art√©rielle",emoji:"üíì",category:"Cardiologie",description:"Pression art√©rielle chroniquement √©lev√©e, souvent asymptomatique.",symptoms:["Souvent asymptomatique","Maux de t√™te matinaux","Vertiges","Bourdonnements d'oreilles","Fatigue"],questionsToAsk:["Avez-vous mesur√© votre tension r√©cemment ?","Avez-vous des ant√©c√©dents familiaux cardiaques ?","Quelle est votre alimentation (sel, alcool) ?","Faites-vous de l'exercice ?","Prenez-vous des m√©dicaments actuellement ?"],treatment:"Mesures hygi√©no-di√©t√©tiques, r√©duction du sel, exercice. IEC/ARA2, diur√©tiques si n√©cessaire.",redFlags:["Tension > 180/120","Douleur thoracique","Troubles visuels soudains","Confusion"]},diabete_type2:{id:"diabete_type2",name:"Diab√®te Type 2",emoji:"ü©∏",category:"Endocrinologie",description:"Trouble m√©tabolique avec r√©sistance √† l'insuline et hyperglyc√©mie.",symptoms:["Soif excessive","Urines fr√©quentes","Fatigue","Vision floue","Cicatrisation lente","Perte de poids"],questionsToAsk:["Avez-vous des ant√©c√©dents familiaux de diab√®te ?","Quel est votre poids et votre taille ?","Avez-vous remarqu√© une soif inhabituelle ?","Urinez-vous plus souvent que d'habitude ?","Avez-vous fait une prise de sang r√©cemment ?"],treatment:"R√©gime alimentaire, exercice physique, metformine. Insuline si non contr√¥l√©.",redFlags:["Perte de poids rapide","Confusion","Odeur d'ac√©tone dans l'haleine","Malaise"]},asthme:{id:"asthme",name:"Asthme",emoji:"üí®",category:"Pneumologie",description:"Maladie inflammatoire chronique des bronches avec crises de dyspn√©e.",symptoms:["Essoufflement","Sifflements respiratoires","Toux s√®che","Oppression thoracique","Crises nocturnes"],questionsToAsk:["Quand surviennent les crises ?","Avez-vous des allergies connues ?","Utilisez-vous un inhalateur ?","Fumez-vous ?","L'exercice d√©clenche-t-il des sympt√¥mes ?"],treatment:"Bronchodilatateurs d'action rapide en crise. Cortico√Ødes inhal√©s en traitement de fond.",redFlags:["Crise ne c√©dant pas au bronchodilatateur","Difficult√© √† parler","L√®vres bleues","Fr√©quence cardiaque > 120"]},angine:{id:"angine",name:"Angine",emoji:"üò∑",category:"ORL",description:"Inflammation des amygdales, virale ou bact√©rienne (streptocoque).",symptoms:["Mal de gorge intense","Difficult√© √† avaler","Fi√®vre","Ganglions cervicaux","Amygdales rouges/blanc"],questionsToAsk:["Depuis quand avez-vous mal ?","Avez-vous de la fi√®vre ?","Avez-vous le nez qui coule ?","Avez-vous des taches blanches sur les amygdales ?","Quel √¢ge avez-vous ?"],treatment:"TDR streptocoque. Si positif : amoxicilline. Sinon : parac√©tamol, repos.",redFlags:["Difficult√©s √† ouvrir la bouche","Voix modifi√©e","Difficult√© respiratoire"]},otite:{id:"otite",name:"Otite",emoji:"üëÇ",category:"ORL",description:"Infection de l'oreille moyenne, fr√©quente chez l'enfant.",symptoms:["Douleur √† l'oreille","Fi√®vre","Audition diminu√©e","√âcoulement possible","Irritabilit√©"],questionsToAsk:["Depuis quand avez-vous mal √† l'oreille ?","Avez-vous eu un rhume r√©cemment ?","Y a-t-il un √©coulement de l'oreille ?","Entendez-vous moins bien ?"],treatment:"Parac√©tamol pour la douleur. Antibiotiques si otite bact√©rienne persistante (amoxicilline).",redFlags:["Rougeur/gonflement derri√®re l'oreille","Fi√®vre tr√®s √©lev√©e","Vertiges intenses"]},depression:{id:"depression",name:"D√©pression",emoji:"üòî",category:"Psychiatrie",description:"Trouble de l'humeur avec tristesse persistante et perte d'int√©r√™t.",symptoms:["Tristesse persistante","Perte d'int√©r√™t","Fatigue","Troubles du sommeil","Perte d'app√©tit","Difficult√©s de concentration","D√©valorisation"],questionsToAsk:["Depuis combien de temps vous sentez-vous ainsi ?","Avez-vous perdu l'int√©r√™t pour vos activit√©s habituelles ?","Comment est votre sommeil ?","Avez-vous des pens√©es sombres ou suicidaires ?","Avez-vous v√©cu un √©v√©nement stressant r√©cemment ?"],treatment:"Psychoth√©rapie (TCC), antid√©presseurs (ISRS) si mod√©r√©e √† s√©v√®re. Suivi r√©gulier.",redFlags:["Id√©es suicidaires","Automutilation","Isolement total","Incapacit√© √† fonctionner"]},anxiete:{id:"anxiete",name:"Trouble Anxieux",emoji:"üò∞",category:"Psychiatrie",description:"Anxi√©t√© excessive et persistante affectant le quotidien.",symptoms:["Inqui√©tude excessive","Tension musculaire","Insomnie","Palpitations","Difficult√©s de concentration","Irritabilit√©"],questionsToAsk:["Qu'est-ce qui vous inqui√®te principalement ?","Depuis combien de temps ressentez-vous cette anxi√©t√© ?","Avez-vous des attaques de panique ?","√âvitez-vous certaines situations ?","Consommez-vous du caf√©, de l'alcool ou d'autres substances ?"],treatment:"Psychoth√©rapie (TCC), techniques de relaxation. Anxiolytiques ponctuels, antid√©presseurs si chronique.",redFlags:["Attaques de panique fr√©quentes","Agoraphobie","Abus de substances","Id√©es suicidaires"]},lombalgie:{id:"lombalgie",name:"Lombalgie",emoji:"ü¶¥",category:"Rhumatologie",description:"Douleur du bas du dos, tr√®s fr√©quente, souvent m√©canique.",symptoms:["Douleur bas du dos","Raideur matinale","Douleur √† l'effort","Irradiation possible dans la jambe","Difficult√© √† se pencher"],questionsToAsk:["Depuis quand avez-vous mal ?","La douleur descend-elle dans la jambe ?","Quel est votre travail ?","Avez-vous fait un faux mouvement ?","Avez-vous des fourmillements ou une perte de force ?"],treatment:"Parac√©tamol/AINS, maintien de l'activit√©, kin√©sith√©rapie. √âviter le repos prolong√©.",redFlags:["Perte de contr√¥le des sphincters","D√©ficit moteur","Fi√®vre","Perte de poids inexpliqu√©e"]},arthrite:{id:"arthrite",name:"Arthrite",emoji:"ü¶µ",category:"Rhumatologie",description:"Inflammation articulaire avec douleur, gonflement et raideur.",symptoms:["Douleur articulaire","Gonflement","Raideur matinale > 30 min","Chaleur locale","Limitation des mouvements"],questionsToAsk:["Quelles articulations sont touch√©es ?","La douleur est-elle pire le matin ?","Combien de temps dure la raideur matinale ?","Avez-vous des ant√©c√©dents familiaux d'arthrite ?","Avez-vous remarqu√© des nodules ou d√©formations ?"],treatment:"AINS, cortico√Ødes si pouss√©e. DMARD (m√©thotrexate) pour PR. Kin√©sith√©rapie.",redFlags:["Fi√®vre avec articulation rouge et gonfl√©e (arthrite septique)","Atteinte multiple rapide"]},dermatite:{id:"dermatite",name:"Dermatite / Ecz√©ma",emoji:"üî¥",category:"Dermatologie",description:"Inflammation cutan√©e avec d√©mangeaisons, rougeurs et s√©cheresse.",symptoms:["Rougeurs","D√©mangeaisons intenses","Peau s√®che","Squames","V√©sicules possibles","Zones typiques (plis)"],questionsToAsk:["O√π sont situ√©es les l√©sions ?","Depuis quand avez-vous ces sympt√¥mes ?","Avez-vous des allergies connues ?","Utilisez-vous un nouveau produit (lessive, savon) ?","Avez-vous des ant√©c√©dents d'asthme ou de rhinite allergique ?"],treatment:"√âmollients quotidiens, dermocortico√Ødes en pouss√©e. √âviction des allerg√®nes si identifi√©s.",redFlags:["Surinfection (pus, cro√ªtes jaunes)","Extension rapide","Fi√®vre"]},pneumonie:{id:"pneumonie",name:"Pneumonie",emoji:"ü´Å",category:"Pneumologie",description:"Infection du parenchyme pulmonaire, bact√©rienne le plus souvent.",symptoms:["Toux productive","Fi√®vre √©lev√©e","Essoufflement","Douleur thoracique √† l'inspiration","Fatigue intense","Frissons"],questionsToAsk:["Depuis quand toussez-vous ?","De quelle couleur sont vos crachats ?","Avez-vous des difficult√©s √† respirer ?","Avez-vous de la fi√®vre ?","Fumez-vous ?"],treatment:"Antibiotiques (amoxicilline). Hospitalisation si signes de gravit√©.",redFlags:["SpO2 < 94%","Confusion","Fr√©quence respiratoire > 30","Tension basse"]},thyroide:{id:"thyroide",name:"Trouble Thyro√Ødien",emoji:"ü¶ã",category:"Endocrinologie",description:"Hypo ou hyperthyro√Ødie affectant le m√©tabolisme.",symptoms:["Fatigue (hypo) / Nervosit√© (hyper)","Prise/perte de poids","Frilosit√©/Bouff√©es de chaleur","Troubles du transit","Palpitations (hyper)","Peau s√®che (hypo)"],questionsToAsk:["Avez-vous pris ou perdu du poids r√©cemment ?","Avez-vous des probl√®mes de sommeil ?","Ressentez-vous des palpitations ?","Avez-vous des ant√©c√©dents thyro√Ødiens familiaux ?","Avez-vous remarqu√© un gonflement au niveau du cou ?"],treatment:"Hypo : l√©vothyroxine. Hyper : antithyro√Ødiens de synth√®se, b√©tabloquants.",redFlags:["Crise thyrotoxique (fi√®vre, tachycardie, agitation)","Coma myx≈ìd√©mateux"]},insuffisance_cardiaque:{id:"insuffisance_cardiaque",name:"Insuffisance Cardiaque",emoji:"‚ù§Ô∏è‚Äçü©π",category:"Cardiologie",description:"Incapacit√© du c≈ìur √† assurer un d√©bit sanguin suffisant.",symptoms:["Essoufflement √† l'effort puis au repos","≈íd√®mes des jambes","Fatigue","Prise de poids rapide","Toux nocturne","Orthopn√©e"],questionsToAsk:["Depuis quand √™tes-vous essouffl√© ?","Dormez-vous avec plusieurs oreillers ?","Avez-vous les jambes enfl√©es ?","Avez-vous pris du poids r√©cemment ?","Avez-vous des ant√©c√©dents cardiaques ?"],treatment:"IEC, b√©tabloquants, diur√©tiques. R√©gime pauvre en sel. Activit√© physique adapt√©e.",redFlags:["≈íd√®me aigu du poumon","D√©tresse respiratoire","Cyanose","Choc cardiog√©nique"]},anemie:{id:"anemie",name:"An√©mie",emoji:"ü©∏",category:"H√©matologie",description:"Diminution du taux d'h√©moglobine dans le sang.",symptoms:["Fatigue","P√¢leur","Essoufflement √† l'effort","Palpitations","Vertiges","Ongles cassants"],questionsToAsk:["Vous sentez-vous fatigu√© en ce moment ?","Vos r√®gles sont-elles abondantes ?","Quelle est votre alimentation en fer ?","Avez-vous observ√© des saignements ?","Avez-vous fait une prise de sang r√©cemment ?"],treatment:"Suppl√©mentation en fer si carentielle. Traiter la cause. Transfusion si s√©v√®re.",redFlags:["Hb < 7 g/dL","Tachycardie > 120","Malaise","Saignement actif"]},ist:{id:"ist",name:"Infection Sexuellement Transmissible",emoji:"üõ°Ô∏è",category:"Infectiologie",description:"Infection transmise par voie sexuelle (chlamydia, gonorrh√©e, syphilis, etc.).",symptoms:["√âcoulements g√©nitaux","Br√ªlures urinaires","L√©sions g√©nitales","Douleurs pelviennes","Parfois asymptomatique"],questionsToAsk:["Avez-vous eu des rapports non prot√©g√©s r√©cemment ?","Avez-vous des sympt√¥mes g√©nitaux ?","Combien de partenaires avez-vous eu r√©cemment ?","Avez-vous d√©j√† √©t√© test√© pour les IST ?","Votre partenaire a-t-il/elle des sympt√¥mes ?"],treatment:"D√©pistage complet. Antibiotiques adapt√©s √† l'IST. Traitement du/des partenaire(s).",redFlags:["Fi√®vre + douleurs pelviennes (salpingite)","L√©sions √©tendues","Suspicion VIH"]},embolie_pulmonaire:{id:"embolie_pulmonaire",name:"Embolie Pulmonaire",emoji:"üö®",category:"Urgence",description:"Obstruction d'une art√®re pulmonaire par un caillot. Urgence vitale.",symptoms:["Douleur thoracique brutale","Essoufflement soudain","Tachycardie","Toux (parfois h√©moptysie)","Anxi√©t√©","Malaise"],questionsToAsk:["La douleur est-elle apparue brutalement ?","Avez-vous √©t√© immobilis√© r√©cemment (voyage, chirurgie) ?","Prenez-vous la pilule contraceptive ?","Avez-vous un mollet gonfl√© ou douloureux ?","Avez-vous des ant√©c√©dents de phl√©bite ?"],treatment:"URGENCE. Anticoagulation imm√©diate (h√©parine). Scanner thoracique. Hospitalisation.",redFlags:["√âtat de choc","Cyanose","Syncope","Instabilit√© h√©modynamique"]},avc:{id:"avc",name:"AVC (Accident Vasculaire C√©r√©bral)",emoji:"üß†",category:"Urgence",description:"Interruption de la circulation sanguine c√©r√©brale. Urgence absolue.",symptoms:["Paralysie d'un c√¥t√© du corps","Troubles de la parole","Perte de vision","Mal de t√™te violent soudain","Vertiges/troubles de l'√©quilibre"],questionsToAsk:["Depuis quand exactement les sympt√¥mes ont-ils commenc√© ?","Pouvez-vous lever les deux bras ?","Avez-vous du mal √† parler ?","Avez-vous des ant√©c√©dents d'hypertension ou de FA ?","Prenez-vous des anticoagulants ?"],treatment:"URGENCE ABSOLUE. Appel 15/SAMU. Thrombolyse si < 4h30. Hospitalisation en UNV.",redFlags:["Tous les sympt√¥mes sont des red flags - URGENCE VITALE"]},meningite:{id:"meningite",name:"M√©ningite",emoji:"üî•",category:"Urgence",description:"Inflammation des m√©ninges, virale ou bact√©rienne. La forme bact√©rienne est une urgence.",symptoms:["Fi√®vre √©lev√©e","Raideur de la nuque","C√©phal√©es intenses","Photophobie","Vomissements en jet","Confusion"],questionsToAsk:["Depuis quand avez-vous de la fi√®vre ?","Pouvez-vous toucher votre poitrine avec votre menton ?","La lumi√®re vous g√™ne-t-elle ?","Avez-vous des taches sur la peau (purpura) ?","Avez-vous √©t√© en contact avec un cas de m√©ningite ?"],treatment:"URGENCE. Ponction lombaire. Antibioth√©rapie IV imm√©diate si bact√©rienne suspect√©e.",redFlags:["Purpura fulminans","Troubles de conscience","√âtat de choc","Convulsions"]},pancreatite:{id:"pancreatite",name:"Pancr√©atite Aigu√´",emoji:"‚ö°",category:"Gastro-ent√©rologie",description:"Inflammation aigu√´ du pancr√©as, souvent li√©e √† l'alcool ou aux calculs biliaires.",symptoms:["Douleur abdominale intense (barre √©pigastrique)","Irradiation dorsale","Naus√©es/vomissements","Fi√®vre","D√©fense abdominale"],questionsToAsk:["O√π exactement avez-vous mal ?","La douleur irradie-t-elle dans le dos ?","Consommez-vous de l'alcool r√©guli√®rement ?","Avez-vous des ant√©c√©dents de calculs biliaires ?","Depuis quand la douleur est-elle pr√©sente ?"],treatment:"Hospitalisation. Mise √† jeun, hydratation IV, antalgiques. Traitement de la cause.",redFlags:["√âtat de choc","D√©faillance d'organes","Surinfection","N√©crose pancr√©atique"]},lupus:{id:"lupus",name:"Lupus √âryth√©mateux Syst√©mique",emoji:"ü¶ã",category:"Rhumatologie",description:"Maladie auto-immune touchant plusieurs organes avec pouss√©es inflammatoires.",symptoms:["√âryth√®me en ailes de papillon","Douleurs articulaires","Fatigue extr√™me","Fi√®vre","Photosensibilit√©","Perte de cheveux"],questionsToAsk:["Avez-vous des rougeurs sur le visage ?","La lumi√®re du soleil aggrave-t-elle vos sympt√¥mes ?","Avez-vous des douleurs articulaires multiples ?","Avez-vous des ant√©c√©dents auto-immuns dans la famille ?","Avez-vous remarqu√© une perte de cheveux ?"],treatment:"Hydroxychloroquine, cortico√Ødes en pouss√©e, immunosuppresseurs si atteinte visc√©rale.",redFlags:["Atteinte r√©nale (prot√©inurie)","P√©ricardite","Thrombose","Cytop√©nie s√©v√®re"]},sclerose_en_plaques:{id:"sclerose_en_plaques",name:"Scl√©rose en Plaques",emoji:"üß¨",category:"Neurologie",description:"Maladie auto-immune du syst√®me nerveux central avec pouss√©es et r√©missions.",symptoms:["Troubles visuels (n√©vrite optique)","Fourmillements/engourdissements","Faiblesse musculaire","Fatigue extr√™me","Troubles de l'√©quilibre","Troubles urinaires"],questionsToAsk:["Avez-vous eu des troubles de la vision ?","Ressentez-vous des fourmillements ?","Avez-vous des difficult√©s √† marcher ?","Ces sympt√¥mes vont-ils et viennent-ils ?","Quel √¢ge avez-vous ?"],treatment:"Cortico√Ødes IV en pouss√©e. Traitements de fond (interf√©rons, natalizumab). R√©√©ducation.",redFlags:["Pouss√©e s√©v√®re avec handicap","Troubles sphinct√©riens","Atteinte du tronc c√©r√©bral"]},maladie_de_crohn:{id:"maladie_de_crohn",name:"Maladie de Crohn",emoji:"üî¨",category:"Gastro-ent√©rologie",description:"Maladie inflammatoire chronique de l'intestin avec pouss√©es et r√©missions.",symptoms:["Douleurs abdominales","Diarrh√©e chronique","Perte de poids","Fatigue","Fi√®vre","Fissures/fistules anales"],questionsToAsk:["Depuis combien de temps avez-vous ces douleurs ?","Y a-t-il du sang dans vos selles ?","Avez-vous perdu du poids ?","Avez-vous des probl√®mes autour de l'anus ?","Avez-vous des ant√©c√©dents familiaux de maladie de Crohn ?"],treatment:"Cortico√Ødes en pouss√©e, immunosuppresseurs, bioth√©rapies (anti-TNF). Chirurgie si complications.",redFlags:["Occlusion intestinale","Perforation","Abc√®s","H√©morragie digestive"]},endocardite:{id:"endocardite",name:"Endocardite Infectieuse",emoji:"üíâ",category:"Cardiologie",description:"Infection des valves cardiaques par un micro-organisme. Urgence diagnostique.",symptoms:["Fi√®vre prolong√©e inexpliqu√©e","Souffle cardiaque nouveau","Fatigue","Sueurs nocturnes","Perte de poids","Taches cutan√©es (Janeway, Osler)"],questionsToAsk:["Depuis combien de temps avez-vous de la fi√®vre ?","Avez-vous eu un soin dentaire r√©cemment ?","Avez-vous une valvulopathie connue ?","Avez-vous des frissons ou des sueurs nocturnes ?","Utilisez-vous des drogues injectables ?"],treatment:"H√©mocultures x3. Antibioth√©rapie IV prolong√©e (4-6 semaines). Chirurgie si indication.",redFlags:["Embolies septiques","Insuffisance cardiaque aigu√´","Abc√®s p√©ri-valvulaire","AVC embolique"]},burn_out:{id:"burn_out",name:"Burn-out",emoji:"üò´",category:"Psychiatrie",description:"√âpuisement professionnel physique, √©motionnel et mental.",symptoms:["Fatigue extr√™me","Cynisme envers le travail","Sentiment d'inefficacit√©","Troubles du sommeil","Irritabilit√©"],questionsToAsk:["Comment vous sentez-vous par rapport √† votre travail ?","Depuis quand ressentez-vous cette fatigue ?","Avez-vous des difficult√©s √† vous concentrer ?","Ressentez-vous du plaisir dans vos activit√©s habituelles ?"],treatment:"Arr√™t de travail imm√©diat, suivi psychologique, repos, parfois antid√©presseurs.",redFlags:["Id√©es suicidaires","Incapacit√© totale √† fonctionner","Abus de substances"]},endometriose:{id:"endometriose",name:"Endom√©triose",emoji:"üéóÔ∏è",category:"Gyn√©cologie",description:"Pr√©sence de tissu ut√©rin hors de l'ut√©rus, causant des douleurs chroniques.",symptoms:["Douleurs pelviennes intenses pendant les r√®gles","Douleurs pendant les rapports","Fatigue chronique","Troubles digestifs","Infertilit√©"],questionsToAsk:["Vos douleurs sont-elles cycliques ?","L'ibuprof√®ne soulage-t-il vos r√®gles ?","Avez-vous des douleurs pour aller √† la selle pendant vos r√®gles ?","Quel est l'impact sur votre vie quotidienne ?"],treatment:"Contraception hormonale, antalgiques, parfois chirurgie (c≈ìlioscopie).",redFlags:["Douleur subite et atroce (rupture de kyste)","Signes d'occlusion intestinale"]},calculs_renaux:{id:"calculs_renaux",name:"Calculs R√©naux",emoji:"üíé",category:"Urologie",description:"Cristaux solides form√©s dans les reins causant une colique n√©phr√©tique.",symptoms:["Douleur atroce dans le dos ou le flanc","Sang dans les urines","Envie fr√©quente d'uriner","Naus√©es","Agitation"],questionsToAsk:["O√π se situe exactement la douleur ?","Avez-vous remarqu√© un changement de couleur de vos urines ?","Arrivez-vous √† trouver une position qui vous soulage ?","Avez-vous de la fi√®vre ?"],treatment:"Hydratation massive, antalgiques puissants (AINS), parfois lithotripsie.",redFlags:["Fi√®vre associ√©e (infection)","Anurie (incapacit√© √† uriner)","Douleur rebelle aux traitements"]},zona:{id:"zona",name:"Zona",emoji:"üêç",category:"Dermatologie",description:"R√©activation du virus de la varicelle causant une √©ruption douloureuse.",symptoms:["Douleur br√ªlante localis√©e","√âruption de v√©sicules en grappes","Rougeur","D√©mangeaisons","Dysesth√©sie"],questionsToAsk:["Est-ce que √ßa vous br√ªle ?","L'√©ruption respecte-t-elle le milieu de votre corps ?","Avez-vous eu la varicelle √©tant enfant ?","Ressentez-vous une grande fatigue ?"],treatment:"Antiviraux (valaciclovir) le plus t√¥t possible, soins locaux, antalgiques.",redFlags:["Atteinte oculaire","Douleurs persistantes (n√©vralgies post-zost√©riennes)"]},anaphylaxie:{id:"anaphylaxie",name:"Anaphylaxie",emoji:"üêù",category:"Allergologie",description:"R√©action allergique g√©n√©ralis√©e grave et potentiellement mortelle.",symptoms:["Urticaire g√©ante","Gonflement des l√®vres/langue","Difficult√© √† respirer","Baisse de tension","Tachycardie"],questionsToAsk:["Avez-vous mang√© quelque chose d'inhabituel ?","Avez-vous √©t√© piqu√© par un insecte ?","Sentez-vous votre gorge se serrer ?","Avez-vous des vertiges ?"],treatment:"Adr√©naline (√âpipen) en urgence, hospitalisation, antihistaminiques.",redFlags:["Stridor (bruit respiratoire)","Perte de connaissance","Cyanose"]}};function Ne(e){return e.map(s=>Re[s]).filter(Boolean)}const me={fichePatient:{id:"fichePatient",name:"Fiche Patient",emoji:"üìã",description:"Voir l'√¢ge, le sexe et le m√©tier du patient avant la consultation.",unlockLevel:3},reponsesRapides:{id:"reponsesRapides",name:"R√©ponses Rapides",emoji:"üí¨",description:"3 r√©ponses pr√©-√©crites contextuelles disponibles pendant la consultation.",unlockLevel:5},referenceMedicale:{id:"referenceMedicale",name:"R√©f√©rence M√©dicale",emoji:"üìñ",description:"Chercher dans vos cartes m√©dicales pendant la consultation.",unlockLevel:7},analysesLaboratoire:{id:"analysesLaboratoire",name:"Analyses de Labo",emoji:"üß™",description:"Obtenir les constantes biologiques cl√©s une fois par consultation.",unlockLevel:9},pauseCafe:{id:"pauseCafe",name:"Pause Caf√©",emoji:"‚òï",description:"Regagner 5 messages de patience chez votre patient.",unlockLevel:11},imagerieMedicale:{id:"imagerieMedicale",name:"Imagerie M√©dicale",emoji:"‚ò¢Ô∏è",description:"Obtenir un rapport de radio ou scanner une fois par consultation.",unlockLevel:13},antecedents:{id:"antecedents",name:"Ant√©c√©dents M√©dicaux",emoji:"üìú",description:"Consulter l'historique m√©dical complet du patient.",unlockLevel:15},indiceDiagnostic:{id:"indiceDiagnostic",name:"Indice Diagnostic",emoji:"üîç",description:"Obtenir un indice sur la pathologie principale du patient.",unlockLevel:17},avisConfrere:{id:"avisConfrere",name:"Avis Confr√®re",emoji:"üë®‚Äç‚öïÔ∏è",description:"Demander un 2√®me avis IA une fois par partie.",unlockLevel:19}};function Ue(e){return Object.values(me).filter(s=>s.unlockLevel<=e)}function pe(e){return Object.values(me).find(s=>s.unlockLevel===e)||null}const B="/game/api";async function Oe(e){const t=await(await fetch(`${B}/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({levelId:e})})).json();if(t.error)throw new Error(t.error);return t}async function Ve(e,s){const i=await(await fetch(`${B}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,message:s})})).json();if(i.error)throw new Error(i.error);return i}async function He(e){const t=await(await fetch(`${B}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e})})).json();if(t.error)throw new Error(t.error);return t}class ve{constructor(){this.currentLevel=null,this.sessionId=null,this.patient=null,this.messages=[],this.isWaiting=!1,this.isFinished=!1,this.messageCount=0,this.onMessage=null,this.onTyping=null,this.onError=null,this.onFinish=null,this.onGuardrailFail=null,this.onEvaluating=null,this.perksUsed={lab:!1,coffee:!1,imaging:!1}}async startLevel(s){const t=je(s);if(!t)throw new Error(`Level ${s} not found`);this.currentLevel=t,this.messages=[],this.isWaiting=!1,this.isFinished=!1,this.messageCount=0;const{sessionId:i,patient:a}=await Oe(s);this.sessionId=i,this.patient=a;const o=Ie(t.cardPool),r=x(),u=Ne(r.unlockedCards),m=Ue(r.maxUnlockedLevel),y=pe(s);return{patient:this.patient,cards:u,perks:m,newCards:o,newPerk:y,level:t}}async sendDoctorMessage(s){if(this.isWaiting||this.isFinished)return;const t=s.trim();if(t){this.isWaiting=!0;try{this.messages.push({role:"doctor",content:t}),this.messageCount++,this.onMessage&&this.onMessage({role:"doctor",content:t}),this.onTyping&&this.onTyping(!0);const i=await Ve(this.sessionId,t);if(this.onTyping&&this.onTyping(!1),i.guardrailFailed){this.messages.pop(),this.messageCount--,this.onGuardrailFail&&this.onGuardrailFail(i.reason||"Message inappropri√©."),this.isWaiting=!1;return}this.messages.push({role:"patient",content:i.message}),this.messageCount++,this.onMessage&&this.onMessage({role:"patient",content:i.message})}catch(i){this.onTyping&&this.onTyping(!1),this.onError&&this.onError(i.message)}this.isWaiting=!1}}async finishConsultation(){if(!this.isFinished){this.isFinished=!0,this.isWaiting=!0,this.onEvaluating&&this.onEvaluating(!0);try{const s=await He(this.sessionId),t=$e(this.currentLevel.id,s.score,s.stars);this.onEvaluating&&this.onEvaluating(!1),this.onFinish&&this.onFinish({...s,levelId:this.currentLevel.id,newMaxLevel:t.maxUnlockedLevel})}catch(s){this.onEvaluating&&this.onEvaluating(!1),this.onError&&this.onError("Erreur lors de l'√©valuation : "+s.message),this.onFinish&&this.onFinish({score:0,stars:0,feedback:"Impossible d'√©valuer la consultation.",anamnese:0,empathie:0,diagnostic:0,priseEnCharge:0,diagnosticCorrect:!1,levelId:this.currentLevel.id,patientCondition:"?"})}this.isWaiting=!1}}async getLabResults(){return this.perksUsed.lab?null:(this.perksUsed.lab=!0,{hemogramme:"Normal",crp:Math.random()>.5?"25 mg/L (√âlev√©e)":"2 mg/L (Normal)",glycemie:"0.95 g/L",sodium:"140 mmol/L"})}useCoffeePause(){return this.perksUsed.coffee?!1:(this.perksUsed.coffee=!0,this.messageCount=Math.max(0,this.messageCount-5),!0)}async getImagingReport(){return this.perksUsed.imaging?null:(this.perksUsed.imaging=!0,"Pas d'anomalie majeure d√©tect√©e sur le clich√© thoracique. L√©g√®re distension abdominale probable.")}static getLevelsWithStatus(){const s=x();return de.map(t=>({...t,unlocked:t.id<=s.maxUnlockedLevel,score:s.scores[t.id]||null}))}}function Ge(e){return e.replace(/\*([^*]+)\*/g,'<em class="patient-action">$1</em>')}function ge(e){const s={debutant:{label:"D√©butant",color:"#2d6a4f",bg:"#d8f3dc"},facile:{label:"Facile",color:"#0077b6",bg:"#caf0f8"},moyen:{label:"Moyen",color:"#e76f51",bg:"#fce4d6"},difficile:{label:"Difficile",color:"#d62828",bg:"#ffd7d7"},expert:{label:"Expert",color:"#7b2cbf",bg:"#ede4f5"},maitre:{label:"Ma√Ætre",color:"#ff006e",bg:"#ffe4f0"}};return s[e]||s.debutant}function U(e,s=3){let t="";for(let i=0;i<s;i++)t+=`<span class="star ${i<e?"star--filled":"star--empty"}">‚òÖ</span>`;return t}let N=null,O=.5,fe=!0;function Be(){return N||(N=new(window.AudioContext||window.webkitAudioContext)),N}function V(e){O=Math.max(0,Math.min(1,e))}function he(e){fe=e}function Q(e,s,t="sine",i=!0){if(!fe||O===0)return;const a=Be(),o=a.createOscillator(),r=a.createGain();o.type=t,o.frequency.setValueAtTime(e,a.currentTime),r.gain.setValueAtTime(O*.3,a.currentTime),i&&r.gain.exponentialRampToValueAtTime(.001,a.currentTime+s),o.connect(r),r.connect(a.destination),o.start(a.currentTime),o.stop(a.currentTime+s)}function A(e,s=.12){e.forEach(([t,i,a],o)=>{setTimeout(()=>Q(t,i,a||"sine"),o*s*1e3)})}function ae(){A([[880,.08,"sine"],[1100,.12,"sine"]],.06)}function Qe(){Q(660,.06,"sine")}function We(){A([[523,.15,"sine"],[659,.15,"sine"],[784,.15,"sine"],[1047,.3,"sine"]],.15)}function Je(){A([[440,.1,"triangle"],[660,.1,"triangle"],[880,.2,"triangle"]],.1)}function oe(){A([[300,.15,"sawtooth"],[200,.25,"sawtooth"]],.12)}function b(){Q(800,.04,"square")}function Ye(){A([[600,.1,"sine"],[800,.1,"sine"],[1e3,.1,"sine"],[1200,.15,"sine"],[1400,.25,"sine"]],.12)}function Ke(e){const t=ve.getLevelsWithStatus().map(i=>{const a=ge(i.difficulty),o=pe(i.id),r=i.score?U(i.score.stars):U(0);return`
      <div class="level-card ${i.unlocked?"":"level-card--locked"}" data-level="${i.id}">
        <div class="level-card__number" style="color: ${a.color}">
          Niveau ${i.id}
        </div>
        <div class="level-card__name">${i.name}</div>
        <div class="level-card__desc">${i.description}</div>
        <div class="level-card__footer">
          <span class="level-card__difficulty" style="background: ${a.bg}; color: ${a.color}">
            ${a.label}
          </span>
          <span class="level-card__stars">${r}</span>
        </div>
        ${o?`
          <div class="level-card__perk">
            üéÅ D√©bloque : ${o.emoji} ${o.name}
          </div>
        `:""}
      </div>
    `}).join("");e.innerHTML=`
    <div class="view level-select">
      <div class="level-select__header">
        <button class="btn btn--icon btn--secondary" id="btn-back">‚Üê</button>
        <h1>S√©lection du Niveau</h1>
      </div>
      <div class="level-select__grid">
        ${t}
      </div>
    </div>
  `,e.querySelector("#btn-back").addEventListener("click",()=>{c("menu")}),e.querySelectorAll(".level-card:not(.level-card--locked)").forEach(i=>{i.addEventListener("click",()=>{b();const a=parseInt(i.dataset.level);c("game",{levelId:a})})})}let l=null,w=!0;async function Ze(e,s){l=new ve,e.innerHTML=`
    <div class="view chat" style="display:flex;align-items:center;justify-content:center">
      <div class="evaluation-loading">
        <div class="evaluation-loading__spinner"></div>
        <div class="evaluation-loading__text">Pr√©paration du patient...</div>
      </div>
    </div>`;let t;try{t=await l.startLevel(s)}catch(n){e.innerHTML=`
        <div class="view chat" style="display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px">
          <div style="font-size:1.2rem;color:var(--text-secondary)">‚ùå ${n.message}</div>
          <button class="btn btn--primary" id="btn-back-error">üè† Retour au menu</button>
        </div>`,e.querySelector("#btn-back-error").addEventListener("click",()=>c("menu"));return}const{patient:i,cards:a,perks:o,newCards:r,newPerk:u,level:m}=t,y=ge(m.difficulty),C=o.some(n=>n.id==="fichePatient"),_e=o.some(n=>n.id==="reponsesRapides"),qe=o.some(n=>n.id==="referenceMedicale"),ke=o.some(n=>n.id==="analysesLaboratoire"),xe=o.some(n=>n.id==="pauseCafe"),Ae=o.some(n=>n.id==="imagerieMedicale"),Ce=o.some(n=>n.id==="antecedents"),Le=o.some(n=>n.id==="indiceDiagnostic"),Te=o.some(n=>n.id==="avisConfrere"),{transcriptionEnabled:Se}=loadSettings();let W=!1,J=!1,Y=!1;const Ee=i.name.firstName[0],Pe=a.map(n=>`
    <div class="medical-card no-select" data-card="${n.id}">
      <div class="medical-card__header">
        <span class="medical-card__emoji">${n.emoji}</span>
        <span class="medical-card__name">${n.name}</span>
        <span class="medical-card__category">${n.category}</span>
      </div>
      <div class="medical-card__details" style="display:none">
        <p>${n.description}</p>
        <div class="medical-card__section">
          <div class="medical-card__section-title">Sympt√¥mes</div>
          <ul>${n.symptoms.map(g=>`<li>${g}</li>`).join("")}</ul>
        </div>
        <div class="medical-card__section">
          <div class="medical-card__section-title">Questions √† poser</div>
          <ul>${n.questionsToAsk.map(g=>`<li>${g}</li>`).join("")}</ul>
        </div>
        <div class="medical-card__treatment">
          <strong>Traitement :</strong> ${n.treatment}
        </div>
        <div class="medical-card__redflags">
          <strong>‚ö†Ô∏è Signaux d'alerte :</strong> ${n.redFlags.join(", ")}
        </div>
      </div>
    </div>
  `).join("");let K="";const p=[];_e&&p.push('<button class="perk-btn" id="perk-quick">üí¨ R√©ponses rapides</button>'),Se&&p.push('<button class="perk-btn" id="perk-voice">üé§ Vocal</button>'),ke&&p.push('<button class="perk-btn" id="perk-lab">üß™ Labo</button>'),xe&&p.push('<button class="perk-btn" id="perk-coffee">‚òï Pause Caf√©</button>'),Ae&&p.push('<button class="perk-btn" id="perk-imaging">‚ò¢Ô∏è Imagerie</button>'),Ce&&p.push('<button class="perk-btn" id="perk-history">üìú Ant√©c√©dents</button>'),Le&&p.push('<button class="perk-btn" id="perk-hint">üîç Indice</button>'),Te&&p.push('<button class="perk-btn" id="perk-peer">üë®‚Äç‚öïÔ∏è Avis confr√®re</button>'),p.length&&(K=`<div class="chat__perks-bar">${p.join("")}</div>`),e.innerHTML=`
    <div class="view chat">
      <div class="chat__header">
        <div class="chat__patient-avatar">${Ee}</div>
        <div class="chat__patient-info">
          <div class="chat__patient-name">${C?i.name.fullName:"Patient"}</div>
          <div class="chat__patient-status" id="patient-status">
            ${C?`${i.name.gender}, ${i.name.age} ans`:"En consultation"}
          </div>
        </div>
        <div class="chat__header-actions">
          <button class="btn btn--small btn--secondary" id="btn-cards-toggle" title="Cartes m√©dicales">üìö</button>
          <button class="btn btn--small btn--secondary" id="btn-restart" title="Recommencer">üîÑ</button>
          <button class="btn btn--small btn--secondary" id="btn-menu" title="Menu">üè†</button>
        </div>
      </div>

      <div class="chat__hud">
        <div class="chat__hud-item">
          <span style="color:${y.color}">‚óè</span> Niv. ${m.id} ‚Äî ${m.name}
        </div>
        <div class="chat__hud-item" id="hud-difficulty" style="color:${y.color}">
          ${y.label}
        </div>
      </div>

      <div class="chat__body">
        <div class="chat__messages-area">
          <div class="chat__messages" id="messages-container">
            <div class="message message--system">
              <div class="message__bubble">
                üè• Le patient entre dans votre cabinet. La consultation commence.
              </div>
            </div>
          </div>

          <div class="chat__input-area">
            <div class="chat__input-wrapper">
              <textarea class="chat__input" id="chat-input" placeholder="√âcrivez votre message au patient..." rows="1"></textarea>
              <button class="chat__send-btn" id="btn-send" title="Envoyer">‚û§</button>
              <button class="chat__finish-btn" id="btn-finish" title="Terminer la consultation">‚úÖ Terminer</button>
            </div>
            ${K}
          </div>
        </div>

        <div class="cards-panel ${qe?"":"cards-panel--hidden"}" id="cards-panel">
          <div class="cards-panel__header">
            <h3>üìö Cartes M√©dicales</h3>
            <button class="btn btn--icon btn--secondary btn--small" id="btn-close-cards" style="width:30px;height:30px;font-size:0.8rem">‚úï</button>
          </div>
          <div class="cards-panel__list">
            ${Pe}
          </div>
        </div>
      </div>
    </div>
  `;const f=e.querySelector("#messages-container"),d=e.querySelector("#chat-input"),$=e.querySelector("#btn-send"),I=e.querySelector("#btn-finish"),Z=e.querySelector("#patient-status"),L=e.querySelector("#cards-panel");L.addEventListener("contextmenu",n=>n.preventDefault()),L.addEventListener("copy",n=>n.preventDefault()),u&&(Ye(),ts(u)),r.length>0&&setTimeout(()=>{Je(),ns(r,a)},u?2e3:500),C&&ss(i,hasPhoto,()=>{d.focus()}),e.querySelectorAll(".medical-card").forEach(n=>{n.addEventListener("click",()=>{const g=n.querySelector(".medical-card__details"),q=g.style.display!=="none";e.querySelectorAll(".medical-card__details").forEach(k=>k.style.display="none"),e.querySelectorAll(".medical-card").forEach(k=>k.classList.remove("medical-card--expanded")),q||(g.style.display="block",n.classList.add("medical-card--expanded"))})}),e.querySelector("#btn-cards-toggle").addEventListener("click",()=>{w=!w,L.classList.toggle("cards-panel--hidden",!w)});const X=e.querySelector("#btn-close-cards");X&&X.addEventListener("click",()=>{w=!1,L.classList.add("cards-panel--hidden")}),e.querySelector("#btn-menu").addEventListener("click",()=>{confirm("Retourner au menu ? La consultation en cours sera perdue.")&&c("menu")}),e.querySelector("#btn-restart").addEventListener("click",()=>{confirm("Recommencer ce niveau ? La consultation en cours sera perdue.")&&c("game",{levelId:s})}),d.addEventListener("input",()=>{d.style.height="auto",d.style.height=Math.min(d.scrollHeight,120)+"px"});async function ee(){const n=d.value.trim();!n||l.isWaiting||l.isFinished||(d.value="",d.style.height="auto",$.disabled=!0,I.disabled=!0,await l.sendDoctorMessage(n),$.disabled=!1,I.disabled=!1,d.focus())}$.addEventListener("click",ee),d.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),ee())}),I.addEventListener("click",()=>{if(l.messages.length<4){v("√âchangez un peu plus avec le patient avant de terminer.","error");return}confirm("Terminer la consultation et recevoir votre √©valuation ?")&&l.finishConsultation()}),l.onMessage=n=>{_(n.role,n.content),n.role==="doctor"?Qe():ae()},l.onTyping=n=>{n?(Z.textContent="√©crit...",ze()):(Z.textContent=C?`${i.name.gender}, ${i.name.age} ans`:"En consultation",Fe())},l.onError=n=>{oe(),v(n,"error")},l.onGuardrailFail=n=>{oe(),v(`‚õî ${n}`,"error")},l.onEvaluating=n=>{n?Xe():es()},l.onFinish=n=>{We(),is(n,s)};const se=e.querySelector("#perk-voice");se&&se.addEventListener("click",()=>re(d));const T=e.querySelector("#perk-photo");T&&T.addEventListener("click",()=>{const n=be(i);v(`üì∏ ${n}`,"success"),T.classList.add("perk-btn--used"),T.disabled=!0});const S=e.querySelector("#perk-history");S&&S.addEventListener("click",()=>{const n=os(i);v(`üìã Ant√©c√©dents:
${n}`,"success"),S.classList.add("perk-btn--used"),S.disabled=!0});const E=e.querySelector("#perk-exams");E&&E.addEventListener("click",()=>{W||(W=!0,_("system","üß™ Examens demand√©s. Les r√©sultats arriveront bient√¥t..."),E.classList.add("perk-btn--used"),E.disabled=!0)});const P=e.querySelector("#perk-hint");P&&P.addEventListener("click",()=>{J||(J=!0,v("üîç Indice: Pensez √† questionner le patient sur ses sympt√¥mes les plus g√™nants.","success"),P.classList.add("perk-btn--used"),P.disabled=!0)});const z=e.querySelector("#perk-peer");z&&z.addEventListener("click",()=>{Y||(Y=!0,_("system",`üë®‚Äç‚öïÔ∏è Confr√®re: "Prenez le temps de bien explorer l'anamn√®se. N'oubliez pas de v√©rifier les ant√©c√©dents et les facteurs de risque."`),ae(),z.classList.add("perk-btn--used"),z.disabled=!0)});const ie=e.querySelector("#perk-quick");ie&&ie.addEventListener("click",()=>{as(d)});const te=e.querySelector("#perk-voice");te&&te.addEventListener("click",()=>{re(d)});const F=e.querySelector("#perk-lab");F&&F.addEventListener("click",async()=>{const n=await l.getLabResults();n&&(_("system",`üß™ R√âSULTATS LABO :
- CRP : ${n.crp}
- Glyc√©mie : ${n.glycemie}
- H√©mogramme : ${n.hemogramme}`),F.disabled=!0,F.style.opacity="0.5",sfx_click())});const M=e.querySelector("#perk-coffee");M&&M.addEventListener("click",()=>{l.useCoffeePause()&&(v("‚òï Pause caf√© : vous avez regagn√© un peu de patience ! (-5 messages)","success"),M.disabled=!0,M.style.opacity="0.5",sfx_click())});const D=e.querySelector("#perk-imaging");D&&D.addEventListener("click",async()=>{const n=await l.getImagingReport();n&&(_("system",`‚ò¢Ô∏è RAPPORT IMAGERIE :
${n}`),D.disabled=!0,D.style.opacity="0.5",sfx_click())});function _(n,g){const q=document.createElement("div"),k=n==="doctor"?"message--doctor":n==="patient"?"message--patient":"message--system";q.className=`message ${k}`;const Me=n==="patient"?Ge(g):g,De=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});q.innerHTML=`
      <div class="message__bubble">${Me}</div>
      ${n!=="system"?`<div class="message__time">${De}</div>`:""}
    `,f.appendChild(q),f.scrollTop=f.scrollHeight}function ze(){let n=f.querySelector(".typing-indicator");n||(n=document.createElement("div"),n.className="typing-indicator",n.innerHTML=`
        <div class="typing-indicator__dot"></div>
        <div class="typing-indicator__dot"></div>
        <div class="typing-indicator__dot"></div>
      `,f.appendChild(n)),f.scrollTop=f.scrollHeight}function Fe(){const n=f.querySelector(".typing-indicator");n&&n.remove()}}function Xe(){if(document.querySelector(".evaluation-overlay"))return;const s=document.createElement("div");s.className="evaluation-overlay",s.innerHTML=`
    <div class="evaluation-loading">
      <div class="evaluation-loading__spinner"></div>
      <div class="evaluation-loading__text">√âvaluation de la consultation en cours...</div>
      <div class="evaluation-loading__sub">L'IA analyse votre performance</div>
    </div>
  `,document.body.appendChild(s)}function es(){const e=document.querySelector(".evaluation-overlay");e&&e.remove()}function v(e,s=""){const t=document.querySelector(".toast");t&&t.remove();const i=document.createElement("div");i.className=`toast ${s?`toast--${s}`:""}`,i.textContent=e,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)}function ss(e,s,t){const i=document.createElement("div");i.className="patient-info";const a=e.name.firstName[0],o=e.modifiers.map(u=>`<span class="modifier-tag">${u.categoryIcon} ${u.name}</span>`).join(""),r=s?be(e):"";i.innerHTML=`
    <div class="patient-info__card">
      <div class="patient-info__avatar">${a}</div>
      <div class="patient-info__name">${e.name.fullName}</div>
      <div class="patient-info__meta">${e.name.gender}, ${e.name.age} ans</div>
      ${s?`<div class="patient-info__desc">${r}</div>`:""}
      <div class="patient-info__modifiers">${o}</div>
      <button class="btn btn--primary patient-info__start-btn" id="btn-start-consult">
        ü©∫ Commencer la consultation
      </button>
    </div>
  `,document.body.appendChild(i),i.querySelector("#btn-start-consult").addEventListener("click",()=>{i.remove(),t&&t()})}function is(e,s){const t=document.createElement("div");t.className="results-overlay";const i=U(e.stars||0);t.innerHTML=`
    <div class="results-card">
      <div class="results-card__title">Consultation Termin√©e</div>
      <div class="results-card__condition">Pathologie : ${e.patientCondition||"?"}</div>
      <div class="results-card__stars">${i}</div>
      <div class="results-card__score">${e.score||0}/100</div>
      <div class="results-card__breakdown">
        <div class="results-card__item">
          <div class="results-card__item-label">Anamn√®se</div>
          <div class="results-card__item-value">${e.anamnese||0}/25</div>
        </div>
        <div class="results-card__item">
          <div class="results-card__item-label">Empathie</div>
          <div class="results-card__item-value">${e.empathie||0}/25</div>
        </div>
        <div class="results-card__item">
          <div class="results-card__item-label">Diagnostic</div>
          <div class="results-card__item-value">${e.diagnostic||0}/25</div>
        </div>
        <div class="results-card__item">
          <div class="results-card__item-label">Prise en charge</div>
          <div class="results-card__item-value">${e.priseEnCharge||0}/25</div>
        </div>
      </div>
      <div class="results-card__feedback">${e.feedback||"Pas de feedback disponible."}</div>
      <div class="results-card__actions">
        <button class="btn btn--secondary" id="result-retry">üîÑ Recommencer</button>
        ${e.stars>=1?'<button class="btn btn--primary" id="result-next">‚ñ∂Ô∏è Niveau suivant</button>':""}
        <button class="btn btn--secondary" id="result-menu">üè† Menu</button>
      </div>
    </div>
  `,document.body.appendChild(t),t.querySelector("#result-retry").addEventListener("click",()=>{t.remove(),c("game",{levelId:s})});const a=t.querySelector("#result-next");a&&a.addEventListener("click",()=>{t.remove(),c("game",{levelId:s+1})}),t.querySelector("#result-menu").addEventListener("click",()=>{t.remove(),c("menu")})}function ts(e){const s=document.createElement("div");s.className="perk-unlock",s.innerHTML=`
    <div class="perk-unlock__title">üéÅ Nouvel atout d√©bloqu√© !</div>
    <div class="perk-unlock__desc">${e.emoji} ${e.name} ‚Äî ${e.description}</div>
  `,document.body.appendChild(s),setTimeout(()=>s.remove(),4e3)}function ns(e,s){const t=s.filter(a=>e.includes(a.id));if(t.length===0)return;const i=document.createElement("div");i.className="new-cards-notif",i.innerHTML=`
    <div class="new-cards-notif__title">üìö ${t.length>1?"Nouvelles cartes":"Nouvelle carte"} d√©bloqu√©e${t.length>1?"s":""} !</div>
    <div class="new-cards-notif__list">
      ${t.map(a=>`<span class="new-cards-notif__card">${a.emoji} ${a.name}</span>`).join("")}
    </div>
  `,document.body.appendChild(i),setTimeout(()=>i.remove(),4e3)}function re(e){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){v("La reconnaissance vocale n'est pas support√©e par votre navigateur.","error");return}const s=window.SpeechRecognition||window.webkitSpeechRecognition,t=new s;t.lang="fr-FR",t.continuous=!1,t.interimResults=!1,v("üé§ Parlez maintenant...","success"),t.onresult=i=>{const a=i.results[0][0].transcript;e.value=a,e.dispatchEvent(new Event("input"))},t.onerror=()=>{v("Erreur de reconnaissance vocale.","error")},t.start()}function as(e){const s=["Pouvez-vous me d√©crire vos sympt√¥mes en d√©tail ?","Depuis quand ressentez-vous ces sympt√¥mes ?","Avez-vous des ant√©c√©dents m√©dicaux ou des allergies ?","Prenez-vous des m√©dicaments actuellement ?","Y a-t-il quelque chose qui aggrave ou am√©liore vos sympt√¥mes ?","Comment est votre sommeil et votre app√©tit r√©cemment ?"],t=document.querySelector(".quick-replies");if(t){t.remove();return}const i=document.createElement("div");i.className="quick-replies",i.style.cssText="position:fixed;bottom:180px;left:50%;transform:translateX(-50%);display:flex;flex-wrap:wrap;gap:6px;justify-content:center;z-index:50;max-width:700px;animation:slideUp 0.2s ease",s.forEach(a=>{const o=document.createElement("button");o.className="perk-btn",o.textContent=a,o.style.cssText="background:white;box-shadow:0 2px 8px rgba(0,0,0,0.1);white-space:nowrap",o.addEventListener("click",()=>{e.value=a,e.dispatchEvent(new Event("input")),e.focus(),i.remove()}),i.appendChild(o)}),document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.remove()},8e3)}function be(e){const s=e.name.isMale?["corpulence moyenne","plut√¥t mince","assez costaud","l√©g√®rement en surpoids"]:["corpulence moyenne","plut√¥t mince","silhouette sportive","l√©g√®rement ronde"],t=["cheveux bruns","cheveux noirs","cheveux blonds","cheveux grisonnants"],i=["lunettes","air fatigu√©","regard fuyant","yeux cern√©s","teint p√¢le","air soucieux"],a=o=>o[Math.floor(Math.random()*o.length)];return`${e.name.gender}, ${e.name.age} ans, ${a(s)}, ${a(t)}, ${a(i)}.`}function os(e){const s=[],t=e.modifiers;return t.find(i=>i.id==="fumeur")&&s.push("‚Ä¢ Tabagisme actif (1 paquet/jour)"),t.find(i=>i.id==="sportif")&&s.push("‚Ä¢ Activit√© sportive r√©guli√®re"),t.find(i=>i.id==="sedentaire")&&s.push("‚Ä¢ Mode de vie s√©dentaire"),t.find(i=>i.id==="enceinte")&&s.push("‚Ä¢ Grossesse en cours"),t.find(i=>i.id==="allergies_multiples")&&s.push("‚Ä¢ Allergies : p√©nicilline, latex"),s.length===0&&(s.push("‚Ä¢ Pas d'ant√©c√©dent notable"),e.name.age>50&&s.push("‚Ä¢ Bilan de sant√© annuel normal l'an dernier")),s.join(`
`)}function rs(e){const s=ue();e.innerHTML=`
    <div class="view settings">
      <div class="settings__header">
        <button class="btn btn--icon btn--secondary" id="btn-back">‚Üê</button>
        <h1>‚öôÔ∏è Param√®tres</h1>
      </div>
      <div class="settings__content">
        <div class="settings__section">
          <div class="settings__section-title">Audio</div>
          <div class="settings__field">
            <label class="settings__label">Volume des effets sonores</label>
            <div class="settings__range-wrapper">
              <span>üîá</span>
              <input
                type="range"
                class="settings__range"
                id="volume-slider"
                min="0"
                max="100"
                value="${Math.round(s.volume*100)}"
              >
              <span>üîä</span>
              <span id="volume-value" style="font-size:0.85rem;font-weight:600;min-width:35px">${Math.round(s.volume*100)}%</span>
            </div>
          </div>
          <div class="settings__toggle">
            <span class="settings__label" style="margin:0">Sons activ√©s</span>
            <div class="toggle-switch ${s.soundEnabled?"toggle-switch--active":""}" id="toggle-sound"></div>
          </div>
        </div>

        <div class="settings__section" style="margin-top:16px">
          <div class="settings__toggle">
            <span class="settings__label" style="margin:0">Transcription Vocale</span>
            <div class="toggle-switch ${s.transcriptionEnabled?"toggle-switch--active":""}" id="toggle-transcription"></div>
          </div>
        </div>

        <div class="settings__section" style="margin-top:16px">
          <div class="settings__toggle">
            <span class="settings__label" style="margin:0">Animations activ√©es</span>
            <div class="toggle-switch ${s.animationsEnabled?"toggle-switch--active":""}" id="toggle-anims"></div>
          </div>
        </div>

        <div class="settings__section" style="margin-top:32px">
          <div class="settings__section-title">Donn√©es</div>
          <button class="btn btn--danger" id="btn-reset" style="width:100%">
            üóëÔ∏è R√©initialiser toute la progression
          </button>
        </div>

        <div class="settings__section" style="margin-top:32px">
          <div class="settings__section-title">√Ä propos</div>
          <p style="font-size:0.85rem;color:var(--text-secondary);line-height:1.6">
            <strong>MedGame</strong> v2.0 ‚Äî Jeu de simulation de consultations m√©dicales.<br>
            Les patients sont g√©n√©r√©s par IA (GPT-4o-mini) avec des personnalit√©s et pathologies al√©atoires.<br>
            Ce jeu est √† but √©ducatif et ludique, il ne remplace en aucun cas un avis m√©dical.
          </p>
        </div>

        <div style="margin-top:20px">
          <button class="btn btn--primary" id="btn-save" style="width:100%">
            üíæ Sauvegarder les param√®tres
          </button>
        </div>
      </div>
    </div>
  `,e.querySelector("#btn-back").addEventListener("click",()=>{c("menu")});const t=e.querySelector("#volume-slider"),i=e.querySelector("#volume-value"),a=e.querySelector("#toggle-sound"),o=e.querySelector("#toggle-anims"),r=e.querySelector("#toggle-transcription");t.addEventListener("input",()=>{const u=parseInt(t.value);i.textContent=u+"%",V(u/100)}),t.addEventListener("change",()=>b()),a.addEventListener("click",()=>{a.classList.toggle("toggle-switch--active"),b()}),o.addEventListener("click",()=>{o.classList.toggle("toggle-switch--active"),b()}),r.addEventListener("click",()=>{r.classList.toggle("toggle-switch--active"),b()}),e.querySelector("#btn-reset").addEventListener("click",()=>{confirm("‚ö†Ô∏è R√©initialiser toute votre progression et vos param√®tres ?")&&(ce(),c("menu"))}),e.querySelector("#btn-save").addEventListener("click",()=>{const u={volume:parseInt(t.value)/100,soundEnabled:a.classList.contains("toggle-switch--active"),animationsEnabled:o.classList.contains("toggle-switch--active"),transcriptionEnabled:r.classList.contains("toggle-switch--active")};we(u),V(u.volume),he(u.soundEnabled);const m=e.querySelector("#btn-save");m.textContent="‚úÖ Sauvegard√© !",m.style.background="linear-gradient(135deg, var(--green-600), var(--green-500))",setTimeout(()=>{m.textContent="üíæ Sauvegarder les param√®tres",m.style.background=""},2e3)})}const h=document.getElementById("app"),ye=ue();V(ye.volume);he(ye.soundEnabled);function c(e,s={}){switch(b(),h.innerHTML="",e){case"menu":ne(h);break;case"levels":Ke(h);break;case"game":Ze(h,s.levelId);break;case"settings":rs(h);break;default:ne(h)}}c("menu");
